<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turbo Bot | Enterprise Trading Dashboard v7</title>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ENTERPRISE TRADING DASHBOARD v7.0 â€” Professional Dark Theme
   Bloomberg/TradingView-inspired design
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg-primary: #0a0e17;
  --bg-secondary: #111827;
  --bg-card: #1a2035;
  --bg-card-hover: #1f2847;
  --bg-input: #0d1321;
  --border: #1e2a42;
  --border-active: #3b5bdb;
  --text-primary: #e8ecf4;
  --text-secondary: #8892a8;
  --text-muted: #5a6478;
  --green: #00e676;
  --green-dim: #00a854;
  --green-bg: rgba(0,230,118,0.08);
  --red: #ff5252;
  --red-dim: #cc3333;
  --red-bg: rgba(255,82,82,0.08);
  --blue: #448aff;
  --blue-dim: #2962ff;
  --blue-bg: rgba(68,138,255,0.08);
  --purple: #b388ff;
  --purple-dim: #7c4dff;
  --purple-bg: rgba(179,136,255,0.08);
  --orange: #ffab40;
  --orange-dim: #ff9100;
  --yellow: #ffd740;
  --cyan: #18ffff;
  --megatron: #ff1744;
  --megatron-bg: rgba(255,23,68,0.06);
  --quantum: #b388ff;
  --font: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
  --mono: 'SF Mono', 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
  --radius: 8px;
  --radius-sm: 4px;
  --shadow: 0 2px 12px rgba(0,0,0,0.3);
  --transition: 0.2s ease;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 13px; }
body {
  font-family: var(--font);
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.5;
  overflow-x: hidden;
  min-height: 100vh;
}
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

/* â”€â”€â”€ HEADER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.header {
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  height: 52px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-left { display: flex; align-items: center; gap: 16px; }
.logo {
  font-size: 1.15rem;
  font-weight: 700;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.logo-icon {
  width: 28px; height: 28px;
  background: linear-gradient(135deg, var(--blue), var(--purple));
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 900;
}
.version-badge {
  font-size: 0.75rem;
  padding: 2px 7px;
  border-radius: 3px;
  background: var(--blue-bg);
  color: var(--blue);
  font-weight: 600;
}
.status-pill {
  display: flex; align-items: center; gap: 6px;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
}
.status-pill.healthy { background: var(--green-bg); color: var(--green); }
.status-pill.error { background: var(--red-bg); color: var(--red); }
.status-pill.warning { background: rgba(255,171,64,0.1); color: var(--orange); }
.status-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: currentColor;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}
.header-center {
  display: flex; align-items: center; gap: 24px;
  font-family: var(--mono);
}
.price-display {
  font-size: 1.2rem;
  font-weight: 700;
  display: flex; align-items: center; gap: 6px;
}
.price-change {
  font-size: 0.8rem;
  padding: 2px 6px;
  border-radius: 3px;
}
.price-change.up { background: var(--green-bg); color: var(--green); }
.price-change.down { background: var(--red-bg); color: var(--red); }
.header-right { display: flex; align-items: center; gap: 12px; }
.header-meta {
  font-size: 0.78rem;
  color: var(--text-secondary);
  display: flex; align-items: center; gap: 4px;
}
.header-meta span { color: var(--text-primary); font-family: var(--mono); }

/* â”€â”€â”€ METRIC ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.metrics-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 1px;
  background: var(--border);
  border-bottom: 1px solid var(--border);
}
.metric-cell {
  background: var(--bg-secondary);
  padding: 10px 16px;
  text-align: center;
}
.metric-label {
  font-size: 0.7rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 2px;
}
.metric-value {
  font-size: 1.1rem;
  font-weight: 700;
  font-family: var(--mono);
}
.metric-value.positive { color: var(--green); }
.metric-value.negative { color: var(--red); }
.metric-sub {
  font-size: 0.7rem;
  color: var(--text-secondary);
  margin-top: 1px;
}

/* â”€â”€â”€ MAIN GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main-grid {
  display: grid;
  grid-template-columns: 1fr 1.3fr 1fr;
  gap: 0;
  min-height: calc(100vh - 52px - 90px);
}
@media (max-width: 1200px) {
  .main-grid { grid-template-columns: 1fr 1fr; }
  .col-right { grid-column: 1 / -1; display: grid; grid-template-columns: 1fr 1fr; gap: 0; }
}
@media (max-width: 768px) {
  .main-grid { grid-template-columns: 1fr; }
  .col-right { grid-template-columns: 1fr; }
}
.col-left, .col-center, .col-right {
  border-right: 1px solid var(--border);
  overflow-y: auto;
  max-height: calc(100vh - 52px - 90px);
}
.col-right { border-right: none; }

/* â”€â”€â”€ PANELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.panel {
  border-bottom: 1px solid var(--border);
}
.panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 16px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  z-index: 2;
}
.panel-title {
  font-size: 0.82rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-secondary);
  display: flex; align-items: center; gap: 8px;
}
.panel-title .icon { font-size: 1rem; }
.panel-badge {
  font-size: 0.7rem;
  padding: 1px 6px;
  border-radius: 3px;
  font-weight: 600;
  font-family: var(--mono);
}
.panel-badge.green { background: var(--green-bg); color: var(--green); }
.panel-badge.blue { background: var(--blue-bg); color: var(--blue); }
.panel-badge.purple { background: var(--purple-bg); color: var(--purple); }
.panel-badge.red { background: var(--red-bg); color: var(--red); }
.panel-badge.orange { background: rgba(255,171,64,0.1); color: var(--orange); }
.panel-body { padding: 12px 16px; }

/* â”€â”€â”€ POSITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.position-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 12px 14px;
  margin-bottom: 8px;
  transition: border-color var(--transition);
}
.position-card:hover { border-color: var(--border-active); }
.position-card.profit { border-left: 3px solid var(--green); }
.position-card.loss { border-left: 3px solid var(--red); }
.pos-top {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 8px;
}
.pos-symbol {
  font-weight: 700; font-size: 1rem;
  display: flex; align-items: center; gap: 6px;
}
.pos-side {
  font-size: 0.7rem;
  padding: 1px 6px;
  border-radius: 3px;
  font-weight: 700;
}
.pos-side.long { background: var(--green-bg); color: var(--green); }
.pos-side.short { background: var(--red-bg); color: var(--red); }
.pos-pnl {
  font-family: var(--mono);
  font-weight: 700;
  font-size: 1.05rem;
}
.pos-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px 16px;
  font-size: 0.8rem;
}
.pos-field { display: flex; justify-content: space-between; }
.pos-field-label { color: var(--text-muted); }
.pos-field-value { font-family: var(--mono); color: var(--text-primary); font-weight: 500; }
.pos-bar-container {
  margin-top: 8px;
  height: 4px;
  background: var(--bg-primary);
  border-radius: 2px;
  overflow: hidden;
  position: relative;
}
.pos-bar {
  height: 100%;
  border-radius: 2px;
  transition: width 0.5s ease;
}
.pos-empty {
  text-align: center;
  padding: 24px;
  color: var(--text-muted);
  font-size: 0.85rem;
}

/* â”€â”€â”€ TRADE TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.trade-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.78rem;
}
.trade-table th {
  text-align: left;
  padding: 6px 8px;
  color: var(--text-muted);
  font-weight: 600;
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  background: var(--bg-secondary);
  z-index: 1;
}
.trade-table td {
  padding: 6px 8px;
  border-bottom: 1px solid rgba(30,42,66,0.5);
  font-family: var(--mono);
  font-size: 0.76rem;
}
.trade-table tr:hover td { background: var(--bg-card-hover); }
.trade-buy { color: var(--green); }
.trade-sell { color: var(--red); }
.trade-pnl-pos { color: var(--green); font-weight: 600; }
.trade-pnl-neg { color: var(--red); font-weight: 600; }

/* â”€â”€â”€ CHARTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chart-container {
  width: 100%;
  background: var(--bg-card);
  border-radius: var(--radius);
  overflow: hidden;
  position: relative;
}
.chart-container svg { display: block; width: 100%; }
.chart-overlay-label {
  position: absolute;
  top: 8px; left: 12px;
  font-size: 0.7rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.chart-overlay-value {
  position: absolute;
  top: 8px; right: 12px;
  font-size: 0.85rem;
  font-family: var(--mono);
  font-weight: 700;
}

/* â”€â”€â”€ HEALTH GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.health-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
}
.health-item {
  display: flex; align-items: center; gap: 8px;
  padding: 6px 10px;
  background: var(--bg-card);
  border-radius: var(--radius-sm);
  font-size: 0.78rem;
}
.health-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}
.health-dot.ok { background: var(--green); box-shadow: 0 0 6px var(--green); }
.health-dot.err { background: var(--red); box-shadow: 0 0 6px var(--red); }
.health-name { color: var(--text-secondary); flex: 1; }

/* â”€â”€â”€ STATUS PANELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stat-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
}
.stat-item {
  padding: 8px 10px;
  background: var(--bg-card);
  border-radius: var(--radius-sm);
}
.stat-label {
  font-size: 0.68rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.stat-value {
  font-size: 0.95rem;
  font-family: var(--mono);
  font-weight: 700;
  margin-top: 2px;
}
.stat-full { grid-column: 1 / -1; }

/* progress bars for exploration rate etc */
.mini-progress {
  height: 3px;
  background: var(--bg-primary);
  border-radius: 2px;
  overflow: hidden;
  margin-top: 4px;
}
.mini-progress-bar {
  height: 100%;
  border-radius: 2px;
  transition: width 0.5s ease;
}

/* â”€â”€â”€ RISK PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.risk-indicator {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  margin-bottom: 6px;
}
.risk-indicator.safe { background: var(--green-bg); border-left: 3px solid var(--green); }
.risk-indicator.warning { background: rgba(255,171,64,0.08); border-left: 3px solid var(--orange); }
.risk-indicator.danger { background: var(--red-bg); border-left: 3px solid var(--red); }
.risk-label { flex: 1; font-size: 0.8rem; }
.risk-value { font-family: var(--mono); font-weight: 700; font-size: 0.85rem; }

/* â”€â”€â”€ BOTTOM BAR (CHAT + ACTIVITY) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bottom-bar {
  display: grid;
  grid-template-columns: 1fr 1fr;
  border-top: 1px solid var(--border);
  height: 300px;
}
@media (max-width: 768px) {
  .bottom-bar { grid-template-columns: 1fr; height: auto; }
}
.activity-panel, .chat-panel {
  display: flex; flex-direction: column;
  overflow: hidden;
}
.chat-panel { border-left: 1px solid var(--border); }
.activity-list {
  flex: 1;
  overflow-y: auto;
  padding: 8px 12px;
}
.activity-item {
  display: flex; gap: 10px;
  padding: 6px 0;
  border-bottom: 1px solid rgba(30,42,66,0.4);
  font-size: 0.78rem;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: none; } }
.activity-icon { font-size: 1rem; flex-shrink: 0; width: 22px; text-align: center; }
.activity-content { flex: 1; min-width: 0; }
.activity-title { font-weight: 600; color: var(--text-primary); }
.activity-desc { color: var(--text-secondary); font-size: 0.72rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.activity-time { color: var(--text-muted); font-size: 0.68rem; font-family: var(--mono); flex-shrink: 0; }
.activity-type {
  font-size: 0.6rem;
  padding: 1px 4px;
  border-radius: 2px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}
.activity-type.TRADE { background: var(--green-bg); color: var(--green); }
.activity-type.SIGNAL { background: var(--blue-bg); color: var(--blue); }
.activity-type.QUANTUM { background: var(--purple-bg); color: var(--purple); }
.activity-type.RISK { background: var(--red-bg); color: var(--red); }
.activity-type.LEARNING { background: rgba(255,215,64,0.1); color: var(--yellow); }
.activity-type.REGIME { background: rgba(24,255,255,0.1); color: var(--cyan); }
.activity-type.MARKET { background: rgba(255,171,64,0.1); color: var(--orange); }
.activity-type.SYSTEM { background: rgba(136,146,168,0.1); color: var(--text-secondary); }
.activity-type.ERROR { background: var(--red-bg); color: var(--red); }

/* â”€â”€â”€ CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 8px 12px;
  display: flex; flex-direction: column; gap: 8px;
}
.chat-msg {
  max-width: 85%;
  padding: 8px 12px;
  border-radius: var(--radius);
  font-size: 0.82rem;
  line-height: 1.45;
  animation: fadeIn 0.3s ease;
}
.chat-msg.user { background: var(--blue-bg); border: 1px solid rgba(68,138,255,0.2); align-self: flex-end; }
.chat-msg.bot { background: var(--megatron-bg); border: 1px solid rgba(255,23,68,0.15); align-self: flex-start; }
.chat-msg .sender { font-size: 0.68rem; font-weight: 700; margin-bottom: 2px; }
.chat-msg.user .sender { color: var(--blue); }
.chat-msg.bot .sender { color: var(--megatron); }
.chat-msg pre { font-family: var(--mono); font-size: 0.76rem; white-space: pre-wrap; margin: 4px 0; background: var(--bg-primary); padding: 6px 8px; border-radius: 4px; }
.chat-input-row {
  display: flex; gap: 8px;
  padding: 8px 12px;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border);
}
.chat-input {
  flex: 1;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 8px 12px;
  color: var(--text-primary);
  font-family: var(--font);
  font-size: 0.82rem;
  outline: none;
  transition: border-color var(--transition);
}
.chat-input:focus { border-color: var(--megatron); }
.chat-input::placeholder { color: var(--text-muted); }
.chat-send {
  background: var(--megatron);
  color: #fff;
  border: none;
  border-radius: var(--radius-sm);
  padding: 8px 16px;
  font-weight: 700;
  font-size: 0.8rem;
  cursor: pointer;
  transition: opacity var(--transition);
}
.chat-send:hover { opacity: 0.85; }
.chat-send:disabled { opacity: 0.4; cursor: not-allowed; }

/* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
  padding: 5px 10px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-size: 0.72rem;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition);
}
.btn:hover { background: var(--bg-card-hover); color: var(--text-primary); border-color: var(--border-active); }
.btn.danger { border-color: var(--red-dim); color: var(--red); }
.btn.danger:hover { background: var(--red-bg); }
.btn.success { border-color: var(--green-dim); color: var(--green); }
.btn.success:hover { background: var(--green-bg); }

/* â”€â”€â”€ REFRESH INDICATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.refresh-ring {
  width: 18px; height: 18px;
  border-radius: 50%;
  border: 2px solid var(--border);
  border-top-color: var(--blue);
  display: inline-block;
  vertical-align: middle;
}
.refresh-ring.spinning { animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast-container {
  position: fixed;
  top: 60px; right: 20px;
  z-index: 200;
  display: flex; flex-direction: column; gap: 8px;
}
.toast {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 10px 16px;
  font-size: 0.8rem;
  box-shadow: var(--shadow);
  animation: slideIn 0.3s ease, fadeOut 0.3s ease 4.7s forwards;
  max-width: 340px;
}
.toast.success { border-left: 3px solid var(--green); }
.toast.error { border-left: 3px solid var(--red); }
.toast.info { border-left: 3px solid var(--blue); }
@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } }
@keyframes fadeOut { to { opacity: 0; transform: translateY(-10px); } }

/* â”€â”€â”€ UTILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.text-green { color: var(--green); }
.text-red { color: var(--red); }
.text-blue { color: var(--blue); }
.text-purple { color: var(--purple); }
.text-orange { color: var(--orange); }
.text-muted { color: var(--text-muted); }
.text-mono { font-family: var(--mono); }
.fw-700 { font-weight: 700; }
.hidden { display: none !important; }
.truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.gap-4 { gap: 4px; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• -->
<header class="header">
  <div class="header-left">
    <div class="logo">
      <div class="logo-icon">TB</div>
      <span>Turbo Bot</span>
    </div>
    <span class="version-badge" id="hdr-version">v7.0</span>
    <div id="hdr-status" class="status-pill healthy"><span class="status-dot"></span> HEALTHY</div>
  </div>
  <div class="header-center">
    <div>
      <span style="color:var(--text-muted);font-size:0.72rem;">BTC/USDT</span>
      <span class="price-display" id="hdr-price">$--</span>
      <span class="price-change up" id="hdr-price-change">--</span>
    </div>
    <div style="display:flex;gap:16px;">
      <div class="header-meta">Mode: <span id="hdr-mode">PAPER</span></div>
      <div class="header-meta">Uptime: <span id="hdr-uptime">--</span></div>
      <div class="header-meta">Cycle: <span id="hdr-cycle">--</span></div>
    </div>
  </div>
  <div class="header-right">
    <div class="header-meta"><span class="refresh-ring" id="refresh-ring"></span> <span id="hdr-refresh">5s</span></div>
    <button class="btn" onclick="refreshAll()" title="Refresh now">&#x21BB; Refresh</button>
  </div>
</header>

<!-- â•â•â•â•â•â•â• METRICS BAR â•â•â•â•â•â•â• -->
<div class="metrics-bar" id="metrics-bar">
  <div class="metric-cell"><div class="metric-label">Portfolio Value</div><div class="metric-value" id="m-total">--</div><div class="metric-sub" id="m-total-sub">Initial: $10,000</div></div>
  <div class="metric-cell"><div class="metric-label">Realized PnL</div><div class="metric-value" id="m-rpnl">--</div><div class="metric-sub" id="m-rpnl-sub">--</div></div>
  <div class="metric-cell"><div class="metric-label">Unrealized PnL</div><div class="metric-value" id="m-upnl">--</div><div class="metric-sub" id="m-upnl-sub">--</div></div>
  <div class="metric-cell"><div class="metric-label">Win Rate</div><div class="metric-value" id="m-winrate">--</div><div class="metric-sub" id="m-winrate-sub">--</div></div>
  <div class="metric-cell"><div class="metric-label">Total Trades</div><div class="metric-value" id="m-trades">--</div><div class="metric-sub" id="m-trades-sub">--</div></div>
  <div class="metric-cell"><div class="metric-label">Drawdown</div><div class="metric-value" id="m-drawdown">--</div><div class="metric-sub" id="m-drawdown-sub">Peak: --</div></div>
  <div class="metric-cell"><div class="metric-label">Open Positions</div><div class="metric-value" id="m-positions">--</div><div class="metric-sub" id="m-positions-sub">Max: 5</div></div>
  <div class="metric-cell"><div class="metric-label">Daily Trades</div><div class="metric-value" id="m-daily">--</div><div class="metric-sub" id="m-daily-sub">Limit: 10</div></div>
</div>

<!-- â•â•â•â•â•â•â• MAIN 3-COLUMN GRID â•â•â•â•â•â•â• -->
<div class="main-grid">

  <!-- â”€â”€â”€ LEFT COLUMN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="col-left">
    <!-- Positions Panel -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">ğŸ“Š</span> Open Positions</div>
        <span class="panel-badge green" id="pos-count">0</span>
      </div>
      <div class="panel-body" id="positions-container">
        <div class="pos-empty">No open positions</div>
      </div>
    </div>

    <!-- Trade History Panel -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">ğŸ“œ</span> Trade History</div>
        <span class="panel-badge blue" id="trades-count">0</span>
      </div>
      <div style="overflow-y:auto;max-height:320px;">
        <table class="trade-table" id="trades-table">
          <thead><tr><th>Time</th><th>Action</th><th>Price</th><th>Qty</th><th>PnL</th><th>Strategy</th></tr></thead>
          <tbody id="trades-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€ CENTER COLUMN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="col-center">
    <!-- Equity Chart -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">ğŸ“ˆ</span> Equity Curve</div>
        <span class="panel-badge green" id="equity-change">--</span>
      </div>
      <div class="panel-body" style="padding:0;">
        <div class="chart-container" id="equity-chart" style="height:180px;"></div>
      </div>
    </div>

    <!-- Trade PnL Chart -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">ğŸ“Š</span> Trade PnL Distribution</div>
      </div>
      <div class="panel-body" style="padding:8px 16px;">
        <div class="chart-container" id="pnl-chart" style="height:130px;"></div>
      </div>
    </div>

    <!-- Component Health -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">ğŸ”§</span> System Health</div>
        <span class="panel-badge green" id="health-badge">--/--</span>
      </div>
      <div class="panel-body">
        <div class="health-grid" id="health-grid"></div>
      </div>
    </div>

    <!-- Config -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">âš™ï¸</span> Configuration</div>
      </div>
      <div class="panel-body">
        <div class="stat-grid" id="config-grid"></div>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€ RIGHT COLUMN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="col-right">
    <!-- ML Engine -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">ğŸ§ </span> ML Engine</div>
        <span class="panel-badge blue" id="ml-phase">--</span>
      </div>
      <div class="panel-body">
        <div class="stat-grid" id="ml-grid"></div>
      </div>
    </div>

    <!-- Quantum Pipeline -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">âš›ï¸</span> Quantum Pipeline</div>
        <span class="panel-badge purple" id="quantum-badge">--</span>
      </div>
      <div class="panel-body">
        <div class="stat-grid" id="quantum-grid"></div>
      </div>
    </div>

    <!-- Neural AI -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">ğŸ”¬</span> Neural AI</div>
        <span class="panel-badge blue" id="neural-badge">--</span>
      </div>
      <div class="panel-body">
        <div class="stat-grid" id="neural-grid"></div>
      </div>
    </div>

    <!-- Risk Management -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon">ğŸ›¡ï¸</span> Risk Management</div>
        <button class="btn danger" id="btn-reset-cb" onclick="resetCircuitBreaker()" style="display:none">Reset CB</button>
      </div>
      <div class="panel-body" id="risk-container"></div>
    </div>

    <!-- Megatron Status -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title"><span class="icon" style="color:var(--megatron)">ğŸ¤–</span> MEGATRON AI</div>
        <span class="panel-badge" id="mega-badge" style="background:var(--megatron-bg);color:var(--megatron)">--</span>
      </div>
      <div class="panel-body">
        <div class="stat-grid" id="mega-grid"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• BOTTOM BAR: ACTIVITY + CHAT â•â•â•â•â•â•â• -->
<div class="bottom-bar">
  <!-- Activity Feed -->
  <div class="activity-panel">
    <div class="panel-header">
      <div class="panel-title"><span class="icon">ğŸ“¡</span> Activity Feed</div>
      <span class="panel-badge blue" id="activity-count">0</span>
    </div>
    <div class="activity-list" id="activity-list"></div>
  </div>
  <!-- Megatron Chat -->
  <div class="chat-panel">
    <div class="panel-header">
      <div class="panel-title"><span class="icon" style="color:var(--megatron)">ğŸ¤–</span> MEGATRON Chat</div>
      <span style="font-size:0.68rem;color:var(--text-muted);">Type <b>help</b> for commands</span>
    </div>
    <div class="chat-messages" id="chat-messages">
      <div class="chat-msg bot">
        <div class="sender">MEGATRON</div>
        <div>Autonomous trading brain online. I monitor markets, analyze patterns, and execute trades 24/7. Ask me anything about the bot, positions, or strategies.</div>
      </div>
    </div>
    <div class="chat-input-row">
      <input type="text" class="chat-input" id="chat-input" placeholder="Ask Megatron anything..." autocomplete="off">
      <button class="chat-send" id="chat-send" onclick="sendChat()">Send</button>
    </div>
  </div>
</div>

<!-- Toast container -->
<div class="toast-container" id="toast-container"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT â€” Full Data Engine
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function() {
  'use strict';

  // â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const API_BASE = window.location.origin;
  const REFRESH_INTERVAL = 5000;
  let refreshTimer = null;
  let lastData = {};
  let equityHistory = [];
  let priceHistory = [];
  let connectionOk = false;
  const MAX_HISTORY = 200;

  // â”€â”€â”€ FORMATTERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function $(id) { return document.getElementById(id); }
  function fmtUSD(v) { if (v == null || isNaN(v)) return '--'; return '$' + v.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2}); }
  function fmtPrice(v) { if (v == null || isNaN(v)) return '--'; return '$' + v.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2}); }
  function fmtPct(v) { if (v == null || isNaN(v)) return '--'; return v.toFixed(2) + '%'; }
  function fmtPnl(v) { if (v == null || isNaN(v)) return '--'; const s = v >= 0 ? '+' : ''; return s + '$' + v.toFixed(2); }
  function fmtTime(ts) {
    if (!ts) return '--';
    const d = new Date(ts);
    return d.toLocaleTimeString('en-GB', {hour:'2-digit',minute:'2-digit',second:'2-digit'});
  }
  function fmtDate(ts) {
    if (!ts) return '--';
    const d = new Date(ts);
    return d.toLocaleDateString('en-GB', {month:'short',day:'numeric'}) + ' ' + d.toLocaleTimeString('en-GB', {hour:'2-digit',minute:'2-digit'});
  }
  function fmtDuration(ms) {
    if (!ms || ms < 0) return '--';
    const s = Math.floor(ms / 1000);
    const m = Math.floor(s / 60);
    const h = Math.floor(m / 60);
    const d = Math.floor(h / 24);
    if (d > 0) return d + 'd ' + (h%24) + 'h';
    if (h > 0) return h + 'h ' + (m%60) + 'm';
    if (m > 0) return m + 'm ' + (s%60) + 's';
    return s + 's';
  }
  function fmtUptime(seconds) {
    if (!seconds) return '--';
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = Math.floor(seconds % 60);
    return String(h).padStart(2,'0') + ':' + String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
  }
  function pnlClass(v) { return v >= 0 ? 'positive' : 'negative'; }
  function pnlColor(v) { return v >= 0 ? 'var(--green)' : 'var(--red)'; }

  // â”€â”€â”€ DATA FETCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function fetchJSON(path) {
    try {
      const r = await fetch(API_BASE + path, { signal: AbortSignal.timeout(8000) });
      if (!r.ok) throw new Error('HTTP ' + r.status);
      return await r.json();
    } catch(e) {
      console.warn('Fetch error ' + path + ':', e.message);
      return null;
    }
  }

  async function fetchAllData() {
    $('refresh-ring').classList.add('spinning');
    const [health, status, portfolio, trades, positions, mlStatus, cbStatus, megaStatus, activities] = await Promise.all([
      fetchJSON('/health'),
      fetchJSON('/api/status'),
      fetchJSON('/api/portfolio'),
      fetchJSON('/api/trades'),
      fetchJSON('/api/positions'),
      fetchJSON('/api/ml/status'),
      fetchJSON('/api/circuit-breaker'),
      fetchJSON('/api/megatron/status'),
      fetchJSON('/api/megatron/activities'),
    ]);
    $('refresh-ring').classList.remove('spinning');

    connectionOk = !!health;
    lastData = { health, status, portfolio, trades, positions, mlStatus, cbStatus, megaStatus, activities };

    // Track equity history
    if (portfolio && portfolio.totalValue) {
      equityHistory.push({ time: Date.now(), value: portfolio.totalValue });
      if (equityHistory.length > MAX_HISTORY) equityHistory.shift();
    }

    // Render everything
    renderHeader(health, status, portfolio, positions);
    renderMetrics(health, portfolio);
    renderPositions(positions);
    renderTrades(trades);
    renderEquityChart();
    renderPnlChart(trades);
    renderHealth(health);
    renderConfig(status);
    renderML(mlStatus, health);
    renderQuantum(health);
    renderNeural(health);
    renderRisk(health, cbStatus);
    renderMegatron(megaStatus);
    renderActivities(activities);
  }

  // â”€â”€â”€ RENDER: HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderHeader(health, status, portfolio, positions) {
    if (!health) {
      $('hdr-status').className = 'status-pill error';
      $('hdr-status').innerHTML = '<span class="status-dot"></span> OFFLINE';
      return;
    }
    const s = health.status || 'unknown';
    $('hdr-status').className = 'status-pill ' + (s === 'healthy' ? 'healthy' : 'error');
    $('hdr-status').innerHTML = '<span class="status-dot"></span> ' + s.toUpperCase();
    $('hdr-version').textContent = health.version || 'v7.0';
    $('hdr-uptime').textContent = fmtUptime(health.metrics ? health.metrics.uptime : health.uptime);
    if (status && status.config) {
      $('hdr-mode').textContent = status.config.paperTrading ? 'PAPER' : (status.config.enableLiveTrading ? 'LIVE' : 'SIM');
    }

    // Price from position
    if (positions && positions.positions && positions.positions.length > 0) {
      const pos = positions.positions[0];
      const pnlPerUnit = portfolio ? (portfolio.unrealizedPnL || 0) / (pos.quantity || 1) : 0;
      const currentPrice = pos.entryPrice + pnlPerUnit;
      $('hdr-price').textContent = fmtPrice(currentPrice);
      priceHistory.push({ time: Date.now(), price: currentPrice });
      if (priceHistory.length > MAX_HISTORY) priceHistory.shift();
      const change = currentPrice - pos.entryPrice;
      const changePct = (change / pos.entryPrice) * 100;
      const el = $('hdr-price-change');
      el.textContent = (change >= 0 ? '+' : '') + changePct.toFixed(2) + '%';
      el.className = 'price-change ' + (change >= 0 ? 'up' : 'down');
    } else if (portfolio) {
      // No position â€” estimate from last known
      if (priceHistory.length > 0) {
        $('hdr-price').textContent = fmtPrice(priceHistory[priceHistory.length-1].price);
      }
    }
    // Cycle count from metrics
    if (health.metrics && health.metrics.uptime) {
      $('hdr-cycle').textContent = Math.floor(health.metrics.uptime / 30);
    }
  }

  // â”€â”€â”€ RENDER: METRICS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderMetrics(health, portfolio) {
    if (!health || !health.metrics) return;
    const m = health.metrics;
    const p = portfolio || {};

    $('m-total').textContent = fmtUSD(m.totalValue || m.portfolioValue);
    $('m-total').className = 'metric-value ' + pnlClass((m.totalValue || 0) - 10000);
    const returnPct = ((m.totalValue || 0) - 10000) / 100;
    $('m-total-sub').textContent = 'Return: ' + (returnPct >= 0 ? '+' : '') + returnPct.toFixed(2) + '%';

    $('m-rpnl').textContent = fmtPnl(m.realizedPnL);
    $('m-rpnl').className = 'metric-value ' + pnlClass(m.realizedPnL);
    $('m-rpnl-sub').textContent = 'Avg: ' + fmtPnl(m.avgTradeReturn);

    $('m-upnl').textContent = fmtPnl(m.unrealizedPnL || p.unrealizedPnL);
    $('m-upnl').className = 'metric-value ' + pnlClass(m.unrealizedPnL || p.unrealizedPnL);
    $('m-upnl-sub').textContent = m.currentPositions + ' position' + (m.currentPositions !== 1 ? 's' : '');

    $('m-winrate').textContent = fmtPct(m.winRate * 100);
    $('m-winrate').className = 'metric-value ' + (m.winRate >= 0.5 ? 'positive' : 'negative');
    $('m-winrate-sub').textContent = m.successfulTrades + 'W / ' + m.failedTrades + 'L';

    $('m-trades').textContent = m.totalTrades;
    $('m-trades-sub').textContent = 'Fee rate: 0.1%';

    $('m-drawdown').textContent = fmtPct(m.drawdown * 100);
    $('m-drawdown').className = 'metric-value ' + (m.drawdown > 0.05 ? 'negative' : '');
    $('m-drawdown-sub').textContent = 'Peak: ' + fmtUSD(m.peakValue);

    $('m-positions').textContent = m.currentPositions;
    $('m-positions-sub').textContent = 'Max: 5';

    $('m-daily').textContent = m.dailyTradeCount || 0;
    $('m-daily-sub').textContent = 'Limit: 10';
  }

  // â”€â”€â”€ RENDER: POSITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderPositions(data) {
    const c = $('positions-container');
    if (!data || !data.positions || data.positions.length === 0) {
      c.innerHTML = '<div class="pos-empty">No open positions</div>';
      $('pos-count').textContent = '0';
      return;
    }
    $('pos-count').textContent = data.positions.length;

    let html = '';
    for (const pos of data.positions) {
      const portfolio = lastData.portfolio || {};
      const upnl = portfolio.unrealizedPnL || 0;
      const pnlPct = pos.entryPrice ? ((upnl / (pos.entryPrice * pos.quantity)) * 100) : 0;
      const holdTime = Date.now() - (pos.entryTime || Date.now());
      const isProfit = upnl >= 0;
      const currentPrice = pos.entryPrice + (upnl / (pos.quantity || 1));
      // SL/TP progress: how far price is between SL and TP
      const slDist = currentPrice - (pos.stopLoss || pos.entryPrice);
      const tpDist = (pos.takeProfit || pos.entryPrice) - (pos.stopLoss || pos.entryPrice);
      const progress = tpDist > 0 ? Math.max(0, Math.min(100, (slDist / tpDist) * 100)) : 50;

      html += '<div class="position-card ' + (isProfit ? 'profit' : 'loss') + '">';
      html += '<div class="pos-top">';
      html += '<div class="pos-symbol">' + pos.symbol + ' <span class="pos-side ' + (pos.side === 'LONG' ? 'long' : 'short') + '">' + pos.side + '</span></div>';
      html += '<div class="pos-pnl" style="color:' + pnlColor(upnl) + '">' + fmtPnl(upnl) + ' <span style="font-size:0.75rem;font-weight:400">(' + (pnlPct >= 0 ? '+' : '') + pnlPct.toFixed(2) + '%)</span></div>';
      html += '</div>';
      html += '<div class="pos-grid">';
      html += '<div class="pos-field"><span class="pos-field-label">Entry</span><span class="pos-field-value">' + fmtPrice(pos.entryPrice) + '</span></div>';
      html += '<div class="pos-field"><span class="pos-field-label">Current</span><span class="pos-field-value" style="color:' + pnlColor(upnl) + '">' + fmtPrice(currentPrice) + '</span></div>';
      html += '<div class="pos-field"><span class="pos-field-label">Stop Loss</span><span class="pos-field-value text-red">' + fmtPrice(pos.stopLoss) + '</span></div>';
      html += '<div class="pos-field"><span class="pos-field-label">Take Profit</span><span class="pos-field-value text-green">' + fmtPrice(pos.takeProfit) + '</span></div>';
      html += '<div class="pos-field"><span class="pos-field-label">Quantity</span><span class="pos-field-value">' + (pos.quantity || 0).toFixed(6) + '</span></div>';
      html += '<div class="pos-field"><span class="pos-field-label">Value</span><span class="pos-field-value">' + fmtUSD(pos.value || (pos.entryPrice * pos.quantity)) + '</span></div>';
      html += '<div class="pos-field"><span class="pos-field-label">ATR</span><span class="pos-field-value">' + (pos.atrAtEntry ? '$' + pos.atrAtEntry.toFixed(2) : '--') + '</span></div>';
      html += '<div class="pos-field"><span class="pos-field-label">Hold Time</span><span class="pos-field-value">' + fmtDuration(holdTime) + '</span></div>';
      html += '</div>';
      // Progress bar: SL (red) â”€â”€â”€ current â”€â”€â”€ TP (green)
      const barColor = isProfit ? 'var(--green)' : 'var(--red)';
      html += '<div class="pos-bar-container"><div class="pos-bar" style="width:' + progress + '%;background:' + barColor + '"></div></div>';
      html += '<div style="display:flex;justify-content:space-between;font-size:0.65rem;color:var(--text-muted);margin-top:2px">';
      html += '<span>SL</span><span>' + progress.toFixed(0) + '% to TP</span><span>TP</span></div>';
      html += '</div>';
    }
    c.innerHTML = html;
  }

  // â”€â”€â”€ RENDER: TRADES TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderTrades(data) {
    const tbody = $('trades-body');
    if (!data || !data.trades || data.trades.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--text-muted);padding:20px">No trades yet</td></tr>';
      $('trades-count').textContent = '0';
      return;
    }
    $('trades-count').textContent = data.trades.length;
    // Show most recent first
    const sorted = [...data.trades].reverse();
    let html = '';
    for (const t of sorted) {
      const isBuy = t.action === 'BUY';
      const pnlCls = t.pnl >= 0 ? 'trade-pnl-pos' : 'trade-pnl-neg';
      const actionCls = isBuy ? 'trade-buy' : 'trade-sell';
      html += '<tr>';
      html += '<td style="color:var(--text-secondary)">' + fmtDate(t.timestamp) + '</td>';
      html += '<td class="' + actionCls + '">' + t.action + '</td>';
      html += '<td>' + fmtPrice(t.price) + '</td>';
      html += '<td>' + (t.quantity || 0).toFixed(6) + '</td>';
      html += '<td class="' + pnlCls + '">' + fmtPnl(t.pnl) + '</td>';
      html += '<td style="color:var(--text-secondary);max-width:80px" class="truncate" title="' + (t.strategy || '') + '">' + (t.strategy || '--') + '</td>';
      html += '</tr>';
    }
    tbody.innerHTML = html;
  }

  // â”€â”€â”€ RENDER: EQUITY CHART (SVG) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderEquityChart() {
    const container = $('equity-chart');
    if (equityHistory.length < 2) {
      container.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--text-muted);font-size:0.8rem">Collecting data...</div>';
      $('equity-change').textContent = '--';
      return;
    }

    const w = container.clientWidth || 500;
    const h = 180;
    const pad = { top: 25, right: 60, bottom: 20, left: 12 };
    const pw = w - pad.left - pad.right;
    const ph = h - pad.top - pad.bottom;

    const values = equityHistory.map(p => p.value);
    const minV = Math.min(...values) * 0.9999;
    const maxV = Math.max(...values) * 1.0001;
    const range = maxV - minV || 1;

    const first = values[0];
    const last = values[values.length - 1];
    const change = last - first;
    const changePct = (change / first) * 100;
    const color = change >= 0 ? 'var(--green)' : 'var(--red)';
    const fillColor = change >= 0 ? 'rgba(0,230,118,0.08)' : 'rgba(255,82,82,0.08)';

    $('equity-change').textContent = (change >= 0 ? '+' : '') + changePct.toFixed(3) + '%';
    $('equity-change').className = 'panel-badge ' + (change >= 0 ? 'green' : 'red');

    let pathD = '';
    let areaD = 'M ' + pad.left + ' ' + (h - pad.bottom) + ' ';
    for (let i = 0; i < values.length; i++) {
      const x = pad.left + (i / (values.length - 1)) * pw;
      const y = pad.top + (1 - (values[i] - minV) / range) * ph;
      pathD += (i === 0 ? 'M ' : 'L ') + x.toFixed(1) + ' ' + y.toFixed(1) + ' ';
      areaD += (i === 0 ? 'L ' : '') + x.toFixed(1) + ' ' + y.toFixed(1) + ' ';
    }
    areaD += 'L ' + (pad.left + pw).toFixed(1) + ' ' + (h - pad.bottom) + ' Z';

    // Y-axis labels
    let labels = '';
    for (let i = 0; i <= 3; i++) {
      const v = minV + (range * i / 3);
      const y = pad.top + (1 - i / 3) * ph;
      labels += '<text x="' + (w - pad.right + 4) + '" y="' + (y + 3) + '" fill="var(--text-muted)" font-size="9" font-family="var(--mono)">' + fmtUSD(v).replace('$','') + '</text>';
      labels += '<line x1="' + pad.left + '" y1="' + y + '" x2="' + (w - pad.right) + '" y2="' + y + '" stroke="var(--border)" stroke-dasharray="2,3"/>';
    }

    // Current value indicator
    const lastY = pad.top + (1 - (last - minV) / range) * ph;

    container.innerHTML = '<svg width="' + w + '" height="' + h + '" viewBox="0 0 ' + w + ' ' + h + '">' +
      labels +
      '<path d="' + areaD + '" fill="' + fillColor + '"/>' +
      '<path d="' + pathD + '" fill="none" stroke="' + color + '" stroke-width="1.5"/>' +
      '<circle cx="' + (pad.left + pw) + '" cy="' + lastY.toFixed(1) + '" r="3" fill="' + color + '"/>' +
      '<text x="' + (pad.left + 4) + '" y="16" fill="var(--text-muted)" font-size="9" font-family="var(--mono)">EQUITY</text>' +
      '<text x="' + (w - pad.right) + '" y="16" fill="' + color + '" font-size="11" font-family="var(--mono)" font-weight="700" text-anchor="end">' + fmtUSD(last) + '</text>' +
      '</svg>';
  }

  // â”€â”€â”€ RENDER: PNL BAR CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderPnlChart(data) {
    const container = $('pnl-chart');
    if (!data || !data.trades || data.trades.length < 2) {
      container.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--text-muted);font-size:0.8rem">Need more trades for chart</div>';
      return;
    }

    const w = container.clientWidth || 500;
    const h = 130;
    const pad = { top: 8, right: 8, bottom: 16, left: 8 };
    const trades = data.trades;
    const pnls = trades.map(t => t.pnl || 0);
    const maxAbs = Math.max(Math.abs(Math.min(...pnls)), Math.abs(Math.max(...pnls)), 1);
    const pw = w - pad.left - pad.right;
    const ph = h - pad.top - pad.bottom;
    const barW = Math.max(2, Math.min(12, (pw / pnls.length) - 1));
    const zeroY = pad.top + ph / 2;

    let bars = '';
    // Zero line
    bars += '<line x1="' + pad.left + '" y1="' + zeroY + '" x2="' + (w - pad.right) + '" y2="' + zeroY + '" stroke="var(--text-muted)" stroke-width="0.5" stroke-dasharray="3,3"/>';

    for (let i = 0; i < pnls.length; i++) {
      const x = pad.left + (i / pnls.length) * pw + (pw / pnls.length - barW) / 2;
      const barH = Math.abs(pnls[i]) / maxAbs * (ph / 2);
      const y = pnls[i] >= 0 ? zeroY - barH : zeroY;
      const color = pnls[i] >= 0 ? 'var(--green)' : 'var(--red)';
      bars += '<rect x="' + x.toFixed(1) + '" y="' + y.toFixed(1) + '" width="' + barW + '" height="' + Math.max(1, barH).toFixed(1) + '" fill="' + color + '" rx="1" opacity="0.8">';
      bars += '<title>Trade #' + (i+1) + ': ' + fmtPnl(pnls[i]) + ' (' + (trades[i].strategy || '') + ')</title>';
      bars += '</rect>';
    }

    // Axis labels
    bars += '<text x="' + pad.left + '" y="' + (h - 2) + '" fill="var(--text-muted)" font-size="8" font-family="var(--mono)">Trade #1</text>';
    bars += '<text x="' + (w - pad.right) + '" y="' + (h - 2) + '" fill="var(--text-muted)" font-size="8" font-family="var(--mono)" text-anchor="end">#' + pnls.length + '</text>';
    bars += '<text x="' + (w - pad.right) + '" y="' + (pad.top + 8) + '" fill="var(--green)" font-size="8" font-family="var(--mono)" text-anchor="end">+' + fmtUSD(Math.max(...pnls)).replace('$','') + '</text>';
    bars += '<text x="' + (w - pad.right) + '" y="' + (h - pad.bottom - 2) + '" fill="var(--red)" font-size="8" font-family="var(--mono)" text-anchor="end">' + fmtUSD(Math.min(...pnls)).replace('$','') + '</text>';

    container.innerHTML = '<svg width="' + w + '" height="' + h + '" viewBox="0 0 ' + w + ' ' + h + '">' + bars + '</svg>';
  }

  // â”€â”€â”€ RENDER: HEALTH GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderHealth(health) {
    const grid = $('health-grid');
    if (!health || !health.components) {
      grid.innerHTML = '<div style="color:var(--text-muted)">No data</div>';
      $('health-badge').textContent = '--/--';
      return;
    }
    const comps = health.components;
    const names = {
      database: 'Database', strategies: 'Strategies', ml: 'ML Engine',
      monitoring: 'Monitoring', riskManager: 'Risk Manager', portfolio: 'Portfolio',
      circuitBreaker: 'Circuit Breaker', neuralAI: 'Neural AI', quantum: 'Quantum Engine',
      hybridPipeline: 'Hybrid Pipeline', quantumPosMgr: 'Quantum Pos Mgr', megatron: 'Megatron AI'
    };
    const total = Object.keys(comps).length;
    const healthy = Object.values(comps).filter(v => v).length;
    $('health-badge').textContent = healthy + '/' + total;
    $('health-badge').className = 'panel-badge ' + (healthy === total ? 'green' : 'red');

    let html = '';
    for (const [key, val] of Object.entries(comps)) {
      html += '<div class="health-item">';
      html += '<div class="health-dot ' + (val ? 'ok' : 'err') + '"></div>';
      html += '<span class="health-name">' + (names[key] || key) + '</span>';
      html += '</div>';
    }
    grid.innerHTML = html;
  }

  // â”€â”€â”€ RENDER: CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderConfig(status) {
    const grid = $('config-grid');
    if (!status || !status.config) {
      grid.innerHTML = '<div style="color:var(--text-muted)">No data</div>';
      return;
    }
    const c = status.config;
    const items = [
      { label: 'Symbol', value: c.symbol || '--' },
      { label: 'Timeframe', value: c.timeframe || '--' },
      { label: 'Strategy', value: c.strategy || '--' },
      { label: 'Interval', value: (c.tradingInterval / 1000) + 's' },
      { label: 'Risk/Trade', value: fmtPct((c.riskPerTrade || 0) * 100) },
      { label: 'Max Drawdown', value: fmtPct((c.maxDrawdown || 0) * 100) },
      { label: 'Fee Rate', value: fmtPct((c.tradingFeeRate || 0) * 100) },
      { label: 'Live Trading', value: c.enableLiveTrading ? 'ON' : 'OFF', color: c.enableLiveTrading ? 'var(--green)' : 'var(--text-muted)' },
    ];
    let html = '';
    for (const item of items) {
      html += '<div class="stat-item"><div class="stat-label">' + item.label + '</div><div class="stat-value" style="font-size:0.82rem;' + (item.color ? 'color:' + item.color : '') + '">' + item.value + '</div></div>';
    }
    grid.innerHTML = html;
  }

  // â”€â”€â”€ RENDER: ML ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderML(mlData, health) {
    const grid = $('ml-grid');
    if (!mlData) {
      grid.innerHTML = '<div style="color:var(--text-muted)">ML offline</div>';
      $('ml-phase').textContent = 'OFFLINE';
      $('ml-phase').className = 'panel-badge red';
      return;
    }
    $('ml-phase').textContent = mlData.phase || '--';
    $('ml-phase').className = 'panel-badge ' + (mlData.phase === 'AUTONOMOUS' ? 'green' : 'blue');

    const m = health && health.metrics ? health.metrics : {};
    const explorationPct = ((mlData.performance ? mlData.performance.exploration_rate : m.mlExplorationRate) || 0) * 100;
    const confidencePct = ((m.mlConfidenceThreshold || mlData.threshold || 0)) * 100;

    let html = '';
    html += '<div class="stat-item"><div class="stat-label">Phase</div><div class="stat-value" style="color:var(--green)">' + (mlData.phase || '--') + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">ML Trades</div><div class="stat-value">' + (m.mlTradingCount || mlData.trades || 0) + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">Confidence</div><div class="stat-value">' + confidencePct.toFixed(0) + '%</div>';
    html += '<div class="mini-progress"><div class="mini-progress-bar" style="width:' + confidencePct + '%;background:var(--blue)"></div></div></div>';
    html += '<div class="stat-item"><div class="stat-label">Exploration</div><div class="stat-value">' + explorationPct.toFixed(1) + '%</div>';
    html += '<div class="mini-progress"><div class="mini-progress-bar" style="width:' + explorationPct + '%;background:var(--orange)"></div></div></div>';
    html += '<div class="stat-item"><div class="stat-label">Episodes</div><div class="stat-value">' + (mlData.performance ? mlData.performance.episodes : 0) + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">Avg Reward</div><div class="stat-value">' + (mlData.performance ? mlData.performance.average_reward.toFixed(2) : '0') + '</div></div>';
    grid.innerHTML = html;
  }

  // â”€â”€â”€ RENDER: QUANTUM PIPELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderQuantum(health) {
    const grid = $('quantum-grid');
    if (!health || !health.components || !health.components.hybridPipeline) {
      grid.innerHTML = '<div style="color:var(--text-muted)">Pipeline offline</div>';
      $('quantum-badge').textContent = 'OFFLINE';
      $('quantum-badge').className = 'panel-badge red';
      return;
    }
    $('quantum-badge').textContent = 'v3.0 ACTIVE';
    $('quantum-badge').className = 'panel-badge purple';

    const qpmActive = health.components.quantumPosMgr;
    const qActive = health.components.quantum;

    let html = '';
    html += '<div class="stat-item"><div class="stat-label">Pipeline</div><div class="stat-value text-purple">v3.0.0 (4-Stage)</div></div>';
    html += '<div class="stat-item"><div class="stat-label">Stages</div><div class="stat-value">Preâ†’Boostâ†’Verifyâ†’Monitor</div></div>';
    html += '<div class="stat-item"><div class="stat-label">QMC</div><div class="stat-value text-green">ACTIVE</div></div>';
    html += '<div class="stat-item"><div class="stat-label">QAOA</div><div class="stat-value text-green">p=4, 150 iters</div></div>';
    html += '<div class="stat-item"><div class="stat-label">VQC</div><div class="stat-value text-green">4q, 3 layers</div></div>';
    html += '<div class="stat-item"><div class="stat-label">QFM</div><div class="stat-value text-green">5 qubits</div></div>';
    html += '<div class="stat-item"><div class="stat-label">QRA + QDV</div><div class="stat-value text-green">ACTIVE</div></div>';
    html += '<div class="stat-item"><div class="stat-label">QPM (Stage 4)</div><div class="stat-value" style="color:' + (qpmActive ? 'var(--green)' : 'var(--red)') + '">' + (qpmActive ? 'ACTIVE' : 'OFF') + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">SQA Engine</div><div class="stat-value" style="color:' + (qActive ? 'var(--green)' : 'var(--red)') + '">' + (qActive ? '8 replicas' : 'OFF') + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">Decomposer</div><div class="stat-value text-green">ACTIVE</div></div>';
    grid.innerHTML = html;
  }

  // â”€â”€â”€ RENDER: NEURAL AI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderNeural(health) {
    const grid = $('neural-grid');
    if (!health || !health.components || !health.components.neuralAI) {
      grid.innerHTML = '<div style="color:var(--text-muted)">Neural AI offline</div>';
      $('neural-badge').textContent = 'OFFLINE';
      return;
    }
    $('neural-badge').textContent = 'ACTIVE';
    $('neural-badge').className = 'panel-badge green';

    let html = '';
    html += '<div class="stat-item"><div class="stat-label">Engine</div><div class="stat-value text-blue">Adaptive Neural</div></div>';
    html += '<div class="stat-item"><div class="stat-label">Models</div><div class="stat-value">GRU + Thomson + Risk</div></div>';
    html += '<div class="stat-item"><div class="stat-label">TensorFlow</div><div class="stat-value text-green">ACTIVE</div></div>';
    html += '<div class="stat-item"><div class="stat-label">Regime Detect</div><div class="stat-value text-green">ACTIVE</div></div>';
    grid.innerHTML = html;
  }

  // â”€â”€â”€ RENDER: RISK MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderRisk(health, cbData) {
    const c = $('risk-container');
    if (!health || !health.metrics) {
      c.innerHTML = '<div style="color:var(--text-muted)">No data</div>';
      return;
    }
    const m = health.metrics;
    const cb = health.circuitBreaker || cbData || {};
    const isTripped = cb.isTripped || m.circuitBreakerTripped;

    // Show/hide reset button
    $('btn-reset-cb').style.display = isTripped ? 'inline-block' : 'none';

    let html = '';
    // Circuit Breaker
    html += '<div class="risk-indicator ' + (isTripped ? 'danger' : 'safe') + '">';
    html += '<div class="risk-label">Circuit Breaker</div>';
    html += '<div class="risk-value" style="color:' + (isTripped ? 'var(--red)' : 'var(--green)') + '">' + (isTripped ? 'TRIPPED' : 'ARMED') + '</div>';
    html += '</div>';

    // Consecutive Losses
    const cl = m.consecutiveLosses || cb.consecutiveLosses || 0;
    const maxCl = cb.maxConsecutiveLosses || 5;
    const clDanger = cl >= maxCl - 1;
    html += '<div class="risk-indicator ' + (clDanger ? 'warning' : 'safe') + '">';
    html += '<div class="risk-label">Consecutive Losses</div>';
    html += '<div class="risk-value">' + cl + ' / ' + maxCl + '</div>';
    html += '</div>';

    // Drawdown
    const dd = (m.drawdown || 0) * 100;
    const ddWarn = dd > 5;
    html += '<div class="risk-indicator ' + (ddWarn ? 'warning' : 'safe') + '">';
    html += '<div class="risk-label">Drawdown</div>';
    html += '<div class="risk-value">' + dd.toFixed(3) + '%</div>';
    html += '</div>';

    // Soft Pause
    html += '<div class="risk-indicator ' + (m.softPauseActive ? 'warning' : 'safe') + '">';
    html += '<div class="risk-label">Soft Pause</div>';
    html += '<div class="risk-value">' + (m.softPauseActive ? 'ACTIVE' : 'INACTIVE') + '</div>';
    html += '</div>';

    // Daily Trades
    const dtWarn = (m.dailyTradeCount || 0) >= 8;
    html += '<div class="risk-indicator ' + (dtWarn ? 'warning' : 'safe') + '">';
    html += '<div class="risk-label">Daily Trades</div>';
    html += '<div class="risk-value">' + (m.dailyTradeCount || 0) + ' / 10</div>';
    html += '</div>';

    // Memory / CPU
    html += '<div class="risk-indicator safe">';
    html += '<div class="risk-label">Memory</div>';
    html += '<div class="risk-value">' + ((m.memoryUsage || 0) * 100).toFixed(0) + '% RSS</div>';
    html += '</div>';

    c.innerHTML = html;
  }

  // â”€â”€â”€ RENDER: MEGATRON STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderMegatron(data) {
    const grid = $('mega-grid');
    if (!data) {
      grid.innerHTML = '<div style="color:var(--text-muted)">Megatron offline</div>';
      $('mega-badge').textContent = 'OFFLINE';
      return;
    }
    $('mega-badge').textContent = data.isReady ? 'ONLINE' : 'INIT';

    let html = '';
    html += '<div class="stat-item"><div class="stat-label">Status</div><div class="stat-value" style="color:var(--megatron)">' + (data.isReady ? 'ONLINE' : 'INIT') + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">Uptime</div><div class="stat-value">' + (data.uptimeFormatted || '--') + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">Messages</div><div class="stat-value">' + (data.messageCount || 0) + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">Commands</div><div class="stat-value">' + (data.commandCount || 0) + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">LLM Calls</div><div class="stat-value">' + (data.llm ? data.llm.totalCalls : 0) + '</div></div>';
    html += '<div class="stat-item"><div class="stat-label">LLM Provider</div><div class="stat-value">' + (data.llm && data.llm.providers ? data.llm.providers.join(', ') : '--') + '</div></div>';

    const stats = data.activityStats || {};
    html += '<div class="stat-item stat-full"><div class="stat-label">Activities</div><div class="stat-value">' + (stats.total || 0) + ' total</div></div>';
    grid.innerHTML = html;
  }

  // â”€â”€â”€ RENDER: ACTIVITY FEED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let lastActivityCount = 0;
  function renderActivities(data) {
    const list = $('activity-list');
    if (!data || !data.activities || data.activities.length === 0) {
      list.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-muted)">No activities yet</div>';
      $('activity-count').textContent = '0';
      return;
    }
    $('activity-count').textContent = data.activities.length;

    // Only re-render if count changed
    if (data.activities.length === lastActivityCount) return;
    lastActivityCount = data.activities.length;

    const sorted = [...data.activities].reverse();
    let html = '';
    for (const act of sorted) {
      html += '<div class="activity-item">';
      html += '<div class="activity-icon">' + (act.icon || 'ğŸ“Œ') + '</div>';
      html += '<div class="activity-content">';
      html += '<div style="display:flex;gap:6px;align-items:center;"><span class="activity-type ' + (act.type || '') + '">' + (act.type || '?') + '</span> <span class="activity-title">' + (act.title || '') + '</span></div>';
      html += '<div class="activity-desc" title="' + escHtml(act.description || '') + '">' + escHtml(act.description || '') + '</div>';
      html += '</div>';
      html += '<div class="activity-time">' + fmtTime(act.timestamp) + '</div>';
      html += '</div>';
    }
    list.innerHTML = html;
  }

  function escHtml(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

  // â”€â”€â”€ CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const chatInput = $('chat-input');
  const chatMessages = $('chat-messages');

  chatInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendChat();
    }
  });

  async function sendChat() {
    const msg = chatInput.value.trim();
    if (!msg) return;
    chatInput.value = '';
    $('chat-send').disabled = true;

    // Add user message
    appendChatMsg('user', 'You', msg);

    try {
      const r = await fetch(API_BASE + '/api/megatron/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: msg }),
        signal: AbortSignal.timeout(30000),
      });
      const data = await r.json();
      if (data.error) {
        appendChatMsg('bot', 'MEGATRON', 'Error: ' + data.error);
      } else {
        appendChatMsg('bot', 'MEGATRON', data.response || data.message || JSON.stringify(data));
      }
    } catch(e) {
      appendChatMsg('bot', 'MEGATRON', 'Connection error: ' + e.message);
    }
    $('chat-send').disabled = false;
    chatInput.focus();
  }
  window.sendChat = sendChat;

  function appendChatMsg(type, sender, text) {
    const div = document.createElement('div');
    div.className = 'chat-msg ' + type;
    div.innerHTML = '<div class="sender">' + escHtml(sender) + '</div><div>' + formatChatText(text) + '</div>';
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function formatChatText(text) {
    // Simple markdown-ish formatting
    text = escHtml(text);
    text = text.replace(/```([\s\S]*?)```/g, '<pre>$1</pre>');
    text = text.replace(/`([^`]+)`/g, '<code style="background:var(--bg-primary);padding:1px 4px;border-radius:2px;font-family:var(--mono);font-size:0.78rem">$1</code>');
    text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    text = text.replace(/\n/g, '<br>');
    return text;
  }

  // â”€â”€â”€ CIRCUIT BREAKER RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function resetCircuitBreaker() {
    try {
      const r = await fetch(API_BASE + '/api/circuit-breaker/reset', { method: 'POST' });
      const d = await r.json();
      showToast('Circuit breaker reset: ' + (d.message || 'OK'), 'success');
      refreshAll();
    } catch(e) {
      showToast('Failed to reset CB: ' + e.message, 'error');
    }
  }
  window.resetCircuitBreaker = resetCircuitBreaker;

  // â”€â”€â”€ TOAST NOTIFICATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showToast(msg, type) {
    const container = $('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast ' + (type || 'info');
    toast.textContent = msg;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 5000);
  }

  // â”€â”€â”€ REFRESH LOOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function refreshAll() {
    try {
      await fetchAllData();
    } catch(e) {
      console.error('Refresh error:', e);
    }
  }
  window.refreshAll = refreshAll;

  function startRefreshLoop() {
    refreshAll();
    let countdown = REFRESH_INTERVAL / 1000;
    $('hdr-refresh').textContent = countdown + 's';

    setInterval(() => {
      countdown--;
      if (countdown <= 0) {
        countdown = REFRESH_INTERVAL / 1000;
        refreshAll();
      }
      $('hdr-refresh').textContent = countdown + 's';
    }, 1000);
  }

  // â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  startRefreshLoop();

  // Re-render charts on resize
  let resizeTimer;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      renderEquityChart();
      if (lastData.trades) renderPnlChart(lastData.trades);
    }, 250);
  });

})();
</script>
</body>
</html>
