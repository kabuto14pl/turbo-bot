
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backtest Visual Report</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #131722; color: #d1d4dc; }
        h1, h2 { color: #ef5350; }
        #chart-container { width: 100%; height: 600px; }
        .stats-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .stats-table th, .stats-table td { border: 1px solid #2a2e39; padding: 8px; text-align: left; }
        .stats-table th { background-color: #2a2e39; }
        #equity-chart-container { width: 100%; height: 400px; margin-top: 20px;}
    </style>
</head>
<body>
    <h1>Backtest Visual Report</h1>
    <h2>Parameters</h2>
    <pre id="parameters"></pre>
    
    <h2>Candlestick Chart with Signals & Indicators</h2>
    <div id="chart-container"></div>

    <h2>Equity Curve</h2>
    <div id="equity-chart-container"></div>

    <h2>Trades</h2>
    <div id="trades-table">
        <!-- Trades table will be injected here -->
    </div>

    <script>
        // --- DATA INJECTION ---
        const chartData = {{CHART_DATA}};
        const signalMarkers = {{SIGNAL_MARKERS}};
        const ema200Data = {{EMA200_DATA}};
        const supertrendData = {{SUPERTREND_DATA}};
        const equityCurveData = {{EQUITY_CURVE_DATA}};
        const tradesContent = `{{TRADES_TABLE}}`;
        const parameters = {{PARAMETERS}};

        document.getElementById('parameters').textContent = JSON.stringify(parameters, null, 2);
        document.getElementById('trades-table').innerHTML = tradesContent;

        // --- CANDLESTICK CHART ---
        const chart = LightweightCharts.createChart(document.getElementById('chart-container'), {
            width: document.getElementById('chart-container').clientWidth,
            height: 600,
            layout: {
                backgroundColor: '#131722',
                textColor: '#d1d4dc',
            },
            grid: {
                vertLines: { color: '#2a2e39' },
                horzLines: { color: '#2a2e39' },
            },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            timeScale: { timeVisible: true, secondsVisible: false },
        });

        const candleSeries = chart.addCandlestickSeries({
            upColor: '#26a69a',
            downColor: '#ef5350',
            borderDownColor: '#ef5350',
            borderUpColor: '#26a69a',
            wickDownColor: '#ef5350',
            wickUpColor: '#26a69a',
        });

        candleSeries.setData(chartData);
        candleSeries.setMarkers(signalMarkers);

        // --- INDICATORS ---
        if (ema200Data && ema200Data.length > 0) {
            const ema200Series = chart.addLineSeries({ color: 'orange', lineWidth: 2, title: 'EMA 200' });
            ema200Series.setData(ema200Data);
        }
        if (supertrendData && supertrendData.length > 0) {
            const supertrendSeries = chart.addLineSeries({ color: 'cyan', lineWidth: 1, title: 'Supertrend' });
            supertrendSeries.setData(supertrendData);
        }

        // --- EQUITY CURVE CHART ---
        const equityChart = LightweightCharts.createChart(document.getElementById('equity-chart-container'), {
            width: document.getElementById('equity-chart-container').clientWidth,
            height: 400,
            layout: { backgroundColor: '#131722', textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#2a2e39' }, horzLines: { color: '#2a2e39' } },
            timeScale: { timeVisible: true, secondsVisible: false },
        });

        const equitySeries = equityChart.addAreaSeries({
            topColor: 'rgba(76, 175, 80, 0.56)',
            bottomColor: 'rgba(76, 175, 80, 0.04)',
            lineColor: 'rgba(76, 175, 80, 1)',
            lineWidth: 2,
        });
        equitySeries.setData(equityCurveData);

    </script>
</body>
</html>
