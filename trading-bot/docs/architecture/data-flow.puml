@startuml DataFlowDiagram

!define PRIMARY_COLOR #2E86AB
!define SECONDARY_COLOR #A23B72
!define SUCCESS_COLOR #F18F01
!define WARNING_COLOR #C73E1D

skinparam activity {
    BackgroundColor PRIMARY_COLOR
    FontColor white
    BorderColor black
}

skinparam note {
    BackgroundColor #FFFACD
    BorderColor #D4AC0D
}

title **Real-time Trading Data Flow - Sub-10ms Latency**

|#LightBlue|Market Data Sources|
start
:ğŸ“¡ **Binance WebSocket**
Otrzymuje tick-by-tick data;
note right
â€¢ BTC/USDT, ETH/USDT streams
â€¢ Kline data (1m, 5m, 15m)
â€¢ Order book depth
â€¢ Trade executions
end note

:ğŸ”„ **Data Normalization**
Standaryzuje formaty;

|#LightGreen|Kafka Streaming|
:ğŸ“¨ **Kafka Producer**
Publikuje na topics;
note right
â€¢ market-data-raw
â€¢ market-data-processed  
â€¢ trade-signals
â€¢ risk-alerts
end note

fork
  :ğŸ“Š **Analytics Topic**
  Dla dÅ‚ugoterminowych analiz;
fork again
  :âš¡ **Real-time Topic** 
  Dla natychmiastowych sygnaÅ‚Ã³w;
end fork

|#LightYellow|Strategy Processing|
:ğŸ§  **Strategy Engine**
Parallel processing;

fork
  :ğŸ“ˆ **Pairs Trading**
  Correlation analysis;
  note right
  â€¢ Cointegration test
  â€¢ Z-score calculation  
  â€¢ Hedge ratio optimization
  end note
fork again
  :ğŸ¯ **RSI Turbo**
  Momentum signals;
  note right
  â€¢ Ultra-optimized RSI (66/29)
  â€¢ Volume confirmation
  â€¢ Trend filtering
  end note
fork again
  :ğŸ“ **Grid Trading**
  Grid level management;
  note right
  â€¢ Dynamic grid sizing
  â€¢ Support/resistance zones
  â€¢ Auto-rebalancing
  end note
end fork

:ğŸ›¡ï¸ **Risk Validation**
Real-time risk checks;

if (Risk Check Passed?) then (âœ… YES)
  :ğŸ“Š **Position Calculation**
  Kelly optimal sizing;
else (âŒ NO)
  :ğŸš« **Signal Rejection**
  Log risk violation;
  stop
endif

|#LightCoral|ML Enhancement|
:ğŸ¤– **TensorFlow Engine**
ML predictions;

fork
  :ğŸ“ˆ **Price Prediction**
  LSTM neural network;
fork again
  :ğŸ¯ **Signal Classification**
  CNN pattern recognition;
fork again
  :âš ï¸ **Risk Assessment**
  Transformer risk model;
end fork

:ğŸ“Š **Ensemble Decision**
Combine ML + traditional;

|#LightPink|Data Persistence|
fork
  :ğŸ’¾ **DuckDB Storage**
  High-performance analytics;
  note right
  â€¢ Compressed columnar storage
  â€¢ Real-time aggregations
  â€¢ Sub-second queries
  end note
fork again
  :ğŸ“ **GDPR Logging**
  Compliance audit trail;
  note right
  â€¢ Encrypted personal data
  â€¢ Automated retention cleanup
  â€¢ Anonymization for analytics
  end note
end fork

|#Orange|Trade Execution|
:âš¡ **Order Management**
Sub-10ms execution;

if (Order Type?) then (Market)
  :ğŸš€ **Immediate Execution**
  Market order;
else (Limit)
  :â° **Limit Order Queue**
  Price monitoring;
endif

:ğŸ“Š **Execution Confirmation**
Update portfolio state;

:ğŸ“ˆ **Performance Tracking**
Real-time P&L;

stop

note bottom
**Key Performance Metrics:**
â€¢ Market data latency: under 5ms
â€¢ Strategy processing: under 3ms  
â€¢ Risk validation: under 1ms
â€¢ Order execution: under 2ms
â€¢ **Total system latency: under 10ms**

**Compliance Features:**
â€¢ GDPR data protection
â€¢ MiFID II trade reporting
â€¢ Real-time audit logging
â€¢ Encrypted data transmission
end note

@enduml
